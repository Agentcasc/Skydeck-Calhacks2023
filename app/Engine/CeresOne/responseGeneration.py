import random
import re
import json
from django.http import HttpResponse
from .HumeConnection import getScores
from .AverageScore import averagescore

scores = [[0.09113388508558273, 0.01762479916214943, 0.051320116966962814, 0.04856540635228157, 0.0025121120270341635, 0.025177758187055588, 0.0009322175174020231, 0.016831345856189728, 0.0212955791503191, 0.08767770975828171, 0.10180732607841492, 0.020145615562796593, 0.05455612391233444, 0.015012858435511589, 0.02506132237613201, 0.08449432253837585, 0.00836213119328022, 0.01632721535861492, 0.011167861521244049, 0.006247023586183786, 0.0014205860206857324, 0.0012633602600544691, 0.0069054048508405685, 0.005390176549553871, 0.0023475440684705973, 0.0009264295222237706, 0.11113765835762024, 0.011465322226285934, 0.014905750751495361, 0.035537686198949814, 0.000297562190098688, 0.041172195225954056, 0.0005410563899204135, 0.00015133181295823306, 0.08846934139728546, 0.06545114517211914, 0.003772847820073366, 0.003737805411219597, 0.0007280324352905154, 0.02364036813378334, 0.022143643349409103, 0.01218198612332344, 0.0009078427101485431, 0.001632317784242332, 0.06657713651657104, 0.11053819954395294, 0.0013080071657896042, 0.0021511309314519167, 0.009810819290578365, 0.061937492340803146, 0.002666726941242814, 0.007410084828734398, 0.04682883992791176], [0.006352982018142939, 0.0018321976531296968, 0.023738659918308258, 0.011376684531569481, 0.0023302696645259857, 0.033053018152713776, 0.009831142611801624, 0.003388764802366495, 0.026660757139325142, 0.18470971286296844, 0.10565707832574844, 0.1394815891981125, 0.12587696313858032, 0.057606909424066544, 0.01848585717380047, 0.08855615556240082, 0.003914419561624527, 0.06177760288119316, 0.01796592026948929, 0.007325417827814817, 0.0018140071770176291, 0.006012243684381247, 0.03692494332790375, 0.0044834609143435955, 0.0033111735247075558, 0.0011310632107779384, 0.05122416093945503, 0.009365950711071491, 0.0015026509063318372, 0.024673501029610634, 0.0022963257506489754, 0.007224824745208025, 0.001134401885792613, 0.00041246938053518534, 0.06488548964262009, 0.013878420926630497, 0.0012112959520891309, 0.0052266851998865604, 0.0028075668960809708, 0.016393782570958138, 0.04742490500211716, 0.021657669916749, 0.0006596494349651039, 0.0026550020556896925, 0.007080184295773506, 0.09826699644327164, 0.0016154893673956394, 0.0034929057583212852, 0.014345456846058369, 0.026827633380889893, 0.0013857018202543259, 0.05269001051783562, 0.05511382594704628], [0.006479095201939344, 0.0035840189084410667, 0.036969829350709915, 0.019066965207457542, 0.002198906848207116, 0.020898455753922462, 0.0074417986907064915, 0.004293969366699457, 0.04169942066073418, 0.16816216707229614, 0.10518519580364227, 0.0488777682185173, 0.2820223867893219, 0.05651124566793442, 0.016435207799077034, 0.0448642261326313, 0.005450084339827299, 0.007204277906566858, 0.02465951442718506, 0.00839321967214346, 0.002697237301617861, 0.007129117380827665, 0.0390808992087841, 0.005545765161514282, 0.00592462532222271, 0.0040984307415783405, 0.01007667277008295, 0.01506833080202341, 0.003385175485163927, 0.005558606702834368, 0.002378022763878107, 0.0029813882429152727, 0.0033035846427083015, 0.001099048531614244, 0.04723837599158287, 0.011858584359288216, 0.003319188253954053, 0.010464065708220005, 0.005655915010720491, 0.005224163644015789, 0.02490631304681301, 0.008250984363257885, 0.002912556752562523, 0.012155765667557716, 0.0075034103356301785, 0.030877452343702316, 0.0058495900593698025, 0.009800892323255539, 0.02188875898718834, 0.009967878460884094, 0.007051099557429552, 0.03669043630361557, 0.01097084116190672], [0.0010817523580044508, 0.0012375437654554844, 0.003842048579826951, 0.008052435703575611, 0.007107562851160765, 0.03341646119952202, 0.08937087655067444, 0.0017714304849505424, 0.23132964968681335, 0.04553024843335152, 0.16108521819114685, 0.009868326596915722, 0.40328317880630493, 0.09171296656131744, 0.02097264677286148, 0.03144540637731552, 0.003434835933148861, 0.004430949687957764, 0.03040022775530815, 0.018313471227884293, 0.005236081779003143, 0.06459195166826248, 0.12673133611679077, 0.0022464445792138577, 0.022342272102832794, 0.0065341368317604065, 0.0026082636322826147, 0.008643057197332382, 0.001023293356411159, 0.0016874349676072598, 0.032919447869062424, 0.0027957605198025703, 0.0180645864456892, 0.0032393946312367916, 0.014832573011517525, 0.004626371897757053, 0.0032197306863963604, 0.0016453871503472328, 0.030834393575787544, 0.0033489703200757504, 0.04452240467071533, 0.009410387836396694, 0.004846436437219381, 0.04899770766496658, 0.023311791941523552, 0.010972259566187859, 0.004263344220817089, 0.03896389156579971, 0.030658792704343796, 0.004802651237696409, 0.00591955054551363, 0.041800037026405334, 0.00303428596816957], [0.010333279147744179, 0.006187187973409891, 0.021555395796895027, 0.020927857607603073, 0.0073515065014362335, 0.051066163927316666, 0.0038816872984170914, 0.006501132156699896, 0.044394757598638535, 0.12916900217533112, 0.0911780446767807, 0.05198581889271736, 0.26535505056381226, 0.02985595352947712, 0.02872021682560444, 0.029840076342225075, 0.002186851343140006, 0.018298719078302383, 0.021919405087828636, 0.0166329313069582, 0.004314961843192577, 0.005596926435828209, 0.03532722219824791, 0.0036419506650418043, 0.0062810457311570644, 0.0030874949879944324, 0.01106400415301323, 0.0133722685277462, 0.004436853341758251, 0.005005468148738146, 0.0017313291318714619, 0.0018523966427892447, 0.0023703500628471375, 0.0010258182883262634, 0.030637802556157112, 0.011973912827670574, 0.006015160121023655, 0.0060652862302958965, 0.004243526607751846, 0.012921101413667202, 0.02506656013429165, 0.00355606060475111, 0.0035875937901437283, 0.00657678721472621, 0.013432731851935387, 0.02151327021420002, 0.005486287176609039, 0.009761824272572994, 0.030628489330410957, 0.012669645249843597, 0.006325484719127417, 0.029654892161488533, 0.017466748133301735], [0.0030414212960749865, 0.001439559506252408, 0.013518829829990864, 0.08973556756973267, 0.003192759118974209, 0.04301505163311958, 0.0042879655957221985, 0.005354622844606638, 0.045439232140779495, 0.2550043761730194, 0.2350684255361557, 0.050353966653347015, 0.1283632069826126, 0.13360784947872162, 0.05090344697237015, 0.05671161413192749, 0.0034696466755121946, 0.00988682173192501, 0.010935611091554165, 0.017909232527017593, 0.004897799808532, 0.003745154244825244, 0.023264087736606598, 0.002735311398282647, 0.005150104407221079, 0.003039878560230136, 0.017139112576842308, 0.015449220314621925, 0.0022018009331077337, 0.008463033474981785, 0.001506452332250774, 0.005447401665151119, 0.0016930676065385342, 0.0010296215768903494, 0.06865441054105759, 0.014137014746665955, 0.0011282955529168248, 0.01943906955420971, 0.0020815141033381224, 0.004799479153007269, 0.033331967890262604, 0.01041150651872158, 0.001296010334044695, 0.004196753725409508, 0.17284749448299408, 0.03001585230231285, 0.0016357942949980497, 0.0047268131747841835, 0.012980815023183823, 0.014130503870546818, 0.003965180832892656, 0.03552790358662605, 0.011187569238245487], [0.006479095201939344, 0.003584017511457205, 0.036969829350709915, 0.019066954031586647, 0.002198906848207116, 0.020898446440696716, 0.00744180241599679, 0.004293969366699457, 0.04169942066073418, 0.16816219687461853, 0.10518524050712585, 0.04887774586677551, 0.2820223867893219, 0.056511230766773224, 0.01643519289791584, 0.04486420005559921, 0.005450081080198288, 0.007204277906566858, 0.02465950883924961, 0.00839321967214346, 0.002697237301617861, 0.0071291206404566765, 0.03908088058233261, 0.0055457595735788345, 0.005924622528254986, 0.00409843260422349, 0.010076658800244331, 0.015068315900862217, 0.003385174088180065, 0.005558606702834368, 0.002378021599724889, 0.0029813882429152727, 0.0033035818487405777, 0.0010990480659529567, 0.04723839834332466, 0.01185857318341732, 0.003319188253954053, 0.010464061051607132, 0.00565591175109148, 0.0052241613157093525, 0.02490631304681301, 0.008250988088548183, 0.0029125551227480173, 0.012155765667557716, 0.007503407541662455, 0.030877429991960526, 0.0058495961129665375, 0.009800887666642666, 0.021888770163059235, 0.009967869147658348, 0.007051099557429552, 0.036690425127744675, 0.010970836505293846], [0.0031786144245415926, 0.0006258192006498575, 0.011638985015451908, 0.014072958379983902, 0.0018109021475538611, 0.05547847971320152, 0.007608475163578987, 0.0031980860512703657, 0.04467245563864708, 0.02006787434220314, 0.07237513363361359, 0.03572234511375427, 0.3084431290626526, 0.424405962228775, 0.0331372432410717, 0.008958549238741398, 0.0005162780871614814, 0.010749639943242073, 0.09365019202232361, 0.10683336853981018, 0.003196907229721546, 0.00696704862639308, 0.3162495791912079, 0.0002337721671210602, 0.006147986277937889, 0.00468933442607522, 0.005372071173042059, 0.007274164818227291, 0.0019365117186680436, 0.0011547718895599246, 0.004046410322189331, 0.001133339130319655, 0.002215056447312236, 0.0005267881788313389, 0.07535205036401749, 0.0011695021530613303, 0.0004901787615381181, 0.0038190619088709354, 0.0017704531783238053, 0.002348362235352397, 0.12648513913154602, 0.0019728897605091333, 0.0008215284906327724, 0.011098155751824379, 0.06110508739948273, 0.006263714283704758, 0.0007781947497278452, 0.008984594605863094, 0.036653533577919006, 0.007206308655440807, 0.006116887088865042, 0.00952078029513359, 0.002386225387454033], [0.0010817544534802437, 0.00123754667583853, 0.0038420523051172495, 0.008052455261349678, 0.007107549346983433, 0.03341641649603844, 0.08937060087919235, 0.0017714333953335881, 0.2313295155763626, 0.04553026705980301, 0.16108551621437073, 0.009868335910141468, 0.40328311920166016, 0.09171289205551147, 0.020972637459635735, 0.03144549950957298, 0.0034348394256085157, 0.004430954344570637, 0.030400151386857033, 0.01831342652440071, 0.0052360650151968, 0.06459174305200577, 0.12673118710517883, 0.002246449002996087, 0.02234223671257496, 0.006534120533615351, 0.0026082699187099934, 0.008643065579235554, 0.0010232923086732626, 0.0016874398570507765, 0.03291936218738556, 0.002795768203213811, 0.01806454360485077, 0.0032393834553658962, 0.014832579530775547, 0.0046263872645795345, 0.003219738369807601, 0.0016453878488391638, 0.03083428367972374, 0.0033489784691482782, 0.04452236369252205, 0.009410402737557888, 0.004846443422138691, 0.048997554928064346, 0.023311840370297432, 0.010972285643219948, 0.004263346083462238, 0.038963790982961655, 0.03065875545144081, 0.004802658222615719, 0.005919544957578182, 0.04179995879530907, 0.0030342950485646725], [0.009383303113281727, 0.003255159128457308, 0.009301520884037018, 0.005826329346746206, 0.0005566028994508088, 0.007745741866528988, 0.002178547438234091, 0.005452967714518309, 0.006839408539235592, 0.05065499618649483, 0.3659013509750366, 0.06290042400360107, 0.009159259498119354, 0.14716880023479462, 0.01325005292892456, 0.08232496678829193, 0.0017633927054703236, 0.016948413103818893, 0.002682449296116829, 0.002453058259561658, 0.0007597404764965177, 0.0020980595145374537, 0.0037651709280908108, 0.0009025633917190135, 0.0005746196256950498, 0.0508635975420475, 0.018888309597969055, 0.005103120114654303, 0.0012442192528396845, 0.004393735900521278, 0.0003284056147094816, 0.010702335275709629, 0.0005841465899720788, 0.00013465572556015104, 0.15068428218364716, 0.007552938535809517, 0.004326569847762585, 0.01013465691357851, 0.003906217636540532, 0.00451135216280818, 0.2283322811126709, 0.04418306052684784, 0.0015263314126059413, 0.003186609363183379, 0.0034975972957909107, 0.06455115228891373, 0.0007795140263624489, 0.0008713342831470072, 0.005027082283049822, 0.019563838839530945, 0.07702469080686569, 0.015913082286715508, 0.009801994077861309], [0.0829705223441124, 0.009827091358602047, 0.016704684123396873, 0.014882374554872513, 0.0043604751117527485, 0.03914400935173035, 0.003555359086021781, 0.11005058884620667, 0.01446978934109211, 0.02064679190516472, 0.06706883013248444, 0.02274070307612419, 0.18146975338459015, 0.1386413425207138, 0.025090748444199562, 0.020485030487179756, 0.0007162881665863097, 0.015284697525203228, 0.07583772391080856, 0.03249610960483551, 0.0035467182751744986, 0.009054694324731827, 0.07539188861846924, 0.0016055199084803462, 0.005246210843324661, 0.01361930649727583, 0.011752074584364891, 0.024717209860682487, 0.01071189809590578, 0.003999052103608847, 0.0027515855617821217, 0.011560970917344093, 0.0015815860824659467, 0.0012440436985343695, 0.045502178370952606, 0.005453611258417368, 0.002153699519112706, 0.009218515828251839, 0.005558064207434654, 0.01975974254310131, 0.11122764647006989, 0.011370310559868813, 0.0009118699235841632, 0.026911811903119087, 0.07008916139602661, 0.021335510537028313, 0.000840325781609863, 0.010295235551893711, 0.11033883690834045, 0.08576186001300812, 0.02025020122528076, 0.023874599486589432, 0.027697661891579628], [0.0030414171051234007, 0.001439558109268546, 0.013518836349248886, 0.08973543345928192, 0.003192760283127427, 0.04301505163311958, 0.004287969321012497, 0.005354620981961489, 0.045439187437295914, 0.2550044059753418, 0.23506835103034973, 0.0503539964556694, 0.12836317718029022, 0.1336079090833664, 0.05090344697237015, 0.0567115880548954, 0.003469649935141206, 0.00988683570176363, 0.010935611091554165, 0.017909232527017593, 0.004897799808532, 0.003745157504454255, 0.023264087736606598, 0.002735312795266509, 0.005150097422301769, 0.003039878560230136, 0.017139121890068054, 0.015449220314621925, 0.0022018009331077337, 0.008463033474981785, 0.0015064538456499577, 0.005447399336844683, 0.0016930676065385342, 0.0010296226246282458, 0.06865443289279938, 0.014137007296085358, 0.0011282943887636065, 0.01943906955420971, 0.002081516431644559, 0.004799472633749247, 0.033331967890262604, 0.01041150651872158, 0.0012960085878148675, 0.004196753725409508, 0.17284740507602692, 0.030015837401151657, 0.0016357926651835442, 0.004726810846477747, 0.012980802915990353, 0.014130489900708199, 0.003965184558182955, 0.03552791848778725, 0.011187569238245487], [0.023655394092202187, 0.008582820184528828, 0.05467589199542999, 0.03315064683556557, 0.0027988103684037924, 0.03139707073569298, 0.004397414159029722, 0.013399945572018623, 0.04674769192934036, 0.18636305630207062, 0.1475639045238495, 0.021849624812602997, 0.20896212756633759, 0.044776830822229385, 0.022055083885788918, 0.09924965351819992, 0.0033772375900298357, 0.0026265380438417196, 0.029572205618023872, 0.011492644436657429, 0.004800945520401001, 0.006527154240757227, 0.019280165433883667, 0.005509156733751297, 0.011767584830522537, 0.0046182977966964245, 0.01130308210849762, 0.017401091754436493, 0.004547487944364548, 0.005261005833745003, 0.001267514773644507, 0.013818182051181793, 0.0032559477258473635, 0.0011062296107411385, 0.05083237215876579, 0.025847584009170532, 0.004376525990664959, 0.013218053616583347, 0.0063062869012355804, 0.011692584492266178, 0.03052877075970173, 0.014615737833082676, 0.0017948044696822762, 0.013603040017187595, 0.015501336194574833, 0.06815942376852036, 0.003238866338506341, 0.01177231129258871, 0.03095783293247223, 0.029545392841100693, 0.006805910263210535, 0.045239467173814774, 0.012937299907207489]]

# Positive Emotions
positive_emotions = [
    'Admiration', 'Adoration', 'Aesthetic Appreciation', 'Amusement',
    'Awe', 'Contentment', 'Ecstasy', 'Enthusiasm', 'Entrancement',
    'Gratitude', 'Joy', 'Love', 'Relief', 'Romance', 'Satisfaction',
    'Surprise (positive)', 'Triumph'
]

# Negative Emotions
negative_emotions = [
    'Anger', 'Annoyance', 'Disappointment', 'Disapproval', 'Disgust',
    'Distress', 'Doubt', 'Embarrassment', 'Empathic Pain', 'Envy',
    'Fear', 'Guilt', 'Horror', 'Sadness', 'Sarcasm', 'Shame',
    'Surprise (negative)', 'Sympathy'
]

# Neutral Emotions
neutral_emotions = [
    'Awkwardness', 'Boredom', 'Calmness', 'Concentration', 'Confusion',
    'Contemplation', 'Contempt', 'Craving', 'Determination', 'Interest',
    'Nostalgia', 'Pain', 'Pride', 'Realization', 'Tiredness'
]


variable_names = [
    'Admiration',
    'Adoration',
    'Aesthetic Appreciation',
    'Amusement',
    'Anger',
    'Annoyance',
    'Anxiety',
    'Awe',
    'Awkwardness',
    'Boredom',
    'Calmness',
    'Concentration',
    'Confusion',
    'Contemplation',
    'Contempt',
    'Contentment',
    'Craving',
    'Determination',
    'Disappointment',
    'Disapproval',
    'Disgust',
    'Distress',
    'Doubt',
    'Ecstasy',
    'Embarrassment',
    'Empathic Pain',
    'Enthusiasm',
    'Entrancement',
    'Envy',
    'Excitement',
    'Fear',
    'Gratitude',
    'Guilt',
    'Horror',
    'Interest',
    'Joy',
    'Love',
    'Nostalgia',
    'Pain',
    'Pride',
    'Realization',
    'Relief',
    'Romance',
    'Sadness',
    'Sarcasm',
    'Satisfaction',
    'Desire',
    'Shame',
    'Surprise (negative)',
    'Surprise (positive)',
    'Sympathy',
    'Tiredness',
    'Triumph'
]


def essayResponse(request):
    essay = request.POST.get('essay', '')  # Get the essay content from the POST request

    print("im cooking")


    sentences = re.split(r'(?<=[.!?])\s+', essay)

    sentence_responses = []




    compare = averagescore()
    dictionary_of_flags = {}

    for i in range(len(scores)):
        flags = []
        for x in range(len(scores[i])):
            if (scores[i][x]/compare[x]) < 0.6:
                flags.append(x)
        dictionary_of_flags[i] = flags



    # for sentence in sentences:
    #     label = random.choice(["good", "not-good"])
    #     sentence_response = {
    #         'sentence': sentence,
    #         'label': label
    #     }
    #     sentence_responses.append(sentence_response)
    #

    for i in range(len(sentences)):

        issues = []
        for x in dictionary_of_flags[i]:
            issues.append(x)

        newdict = {}


        flag = "neutral"



        newdict[i] = []
        for x in dictionary_of_flags[i]:
            newdict[i].append(variable_names[x])

        countpositive = 0
        countnegative = 0
        countneutral = 0

        for x in newdict:

            for y in newdict[x]:
                if y in positive_emotions:
                    countpositive += 1
                elif y in negative_emotions:
                    countnegative += 1
                elif y in neutral_emotions:
                    countneutral += 1

        flag = max(countpositive, countnegative, countneutral)

        if flag == countpositive:
            flag = "positive"
        elif flag == countnegative:
            flag = "negative"
        elif flag == countneutral:
            flag = "neutral"









        sentence_response = {
            'sentence': sentences[i],
            'flags': flag,
            'flagindex': issues
        }
        sentence_responses.append(sentence_response)

        print(sentence_response)


    # Convert the sentence_responses list to JSON format
    json_response = json.dumps(sentence_responses)

    # Set the content type of the HTTP response to application/json
    response = HttpResponse(json_response, content_type='application/json')

    return response
